<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tulipmetric - ì‚°ì—…êµ°ë³„ ì‹œì¥ ì§€í‘œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h1 { font-size: 1.5rem; font-weight: 500; line-height: 1.5; }
    h2 { font-size: 1.25rem; font-weight: 500; line-height: 1.5; }
    h3 { font-size: 1.125rem; font-weight: 500; line-height: 1.5; }
    h4 { font-size: 1rem; font-weight: 500; line-height: 1.5; }
    label, button { font-size: 1rem; font-weight: 500; line-height: 1.5; }
    input { font-size: 1rem; font-weight: 400; line-height: 1.5; }

    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100"
      th:attr="data-has-server-wishlist=${wishlist != null}">
  <!-- Header -->
  <div th:replace="~{fragments/basicheader :: basicheader-fragment}"></div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Hero Section -->
    <div class="mb-8 text-center">
      <h2 class="text-slate-900 mb-3">ì‚°ì—…êµ°ë³„ ì‹œì¥ ì§€í‘œ ë¶„ì„</h2>
      <p class="text-slate-600 max-w-2xl mx-auto">
        íŠ¤ë¦½ìœ¼ë¡œ í‘œí˜„ë˜ëŠ” ì‹œì¥ì˜ ì˜¨ë„ë¥¼ í™•ì¸í•˜ê³ , ê° ì‚°ì—…êµ°ì˜ ì„±ì¥ ë™í–¥ì„ í•œëˆˆì— íŒŒì•…í•˜ì„¸ìš”
      </p>
    </div>

    <!-- Search Bar -->
    <div class="mb-8 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
      <div class="flex flex-col md:flex-row gap-4">
        <div class="flex-1 relative">
          <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <input
            type="text"
            id="searchInput"
            placeholder="ì‚°ì—…êµ°ëª…ìœ¼ë¡œ ê²€ìƒ‰..."
            class="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          />
        </div>
        <div>
          <select id="statusFilter" class="px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="all">ì „ì²´ ìƒíƒœ</option>
            <option value="overvalued">ê³¼ì—´ (ë§¤ìš° í™”ë ¤í•œ íŠ¤ë¦½)</option>
            <option value="growing">ê°•í•œ ìƒìŠ¹ (í™”ë ¤í•œ íŠ¤ë¦½)</option>
            <option value="stable">ì•ˆì • ìƒìŠ¹ (í‰ë²”í•œ íŠ¤ë¦½)</option>
            <option value="declining">í•˜ë½ (ì‹œë“  íŠ¤ë¦½)</option>
            <option value="crashed">ê¸‰ë½ (êº¾ì¸ íŠ¤ë¦½)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Market Temperature Section -->
    <section class="mb-12" id="marketTempSection">
      <div class="relative overflow-hidden bg-gradient-to-br from-slate-50 via-white to-blue-50 rounded-3xl shadow-xl border border-slate-200">
        <div class="absolute top-0 right-0 w-96 h-96 bg-gradient-to-br from-purple-200/30 to-pink-200/30 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-96 h-96 bg-gradient-to-tr from-blue-200/30 to-indigo-200/30 rounded-full blur-3xl"></div>

        <div class="relative px-8 py-16">
          <div class="text-center max-w-3xl mx-auto">
            <div class="mb-8">
              <p class="text-sm tracking-wider uppercase text-slate-400 mb-3" style="font-weight: 300;">í˜„ì¬ ì‹œì¥ì€...</p>
              <h2 id="marketTitle" class="text-5xl md:text-6xl mb-2 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-600"
                  style="font-weight: 300; letter-spacing: -0.025em;">ì•ˆì •ì ì¸ ì‹œì¥</h2>
            </div>

            <div class="flex justify-center mb-8">
              <div class="relative">
                <div class="absolute inset-0 blur-2xl opacity-40 bg-blue-400"></div>
                <div id="marketTulip" class="relative transform hover:scale-110 transition-transform duration-500 ease-out"></div>
              </div>
            </div>

            <div class="mb-8">
              <p id="marketDescription" class="text-xl md:text-2xl text-blue-700" style="font-weight: 300;">ì‹ ê¸°ìˆ  ì¤‘ì‹¬ìœ¼ë¡œ ê´€ì‹¬ì´ ì ë¦½ë‹ˆë‹¤</p>
            </div>

            <div class="inline-flex items-center gap-2 px-6 py-3 bg-white/80 backdrop-blur-sm rounded-full border border-slate-200 shadow-sm">
              <span class="text-sm text-slate-500">í‰ê·  ì„±ì¥ë¥ </span>
              <span id="avgGrowthRate" class="text-xl text-green-600">+0.0%</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Favorites Section -->
    <section class="mb-12" id="favoritesSection" style="display: none;">
      <div class="flex items-center gap-3 mb-6">
        <svg class="w-7 h-7 text-yellow-500 fill-current" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        <h2 class="text-slate-900">ì¦ê²¨ì°¾ê¸°</h2>
      </div>
      <div id="favoritesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <!-- Trending Industries -->
    <section class="mb-12" id="trendingSection">
      <div class="flex items-center gap-3 mb-6">
        <svg class="w-7 h-7 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>
        </svg>
        <h2 class="text-slate-900">ë¹ ë¥´ê²Œ ì„±ì¥ì¤‘ì¸ ì‚°ì—…êµ°</h2>
      </div>

      <div id="trendingList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <th:block th:each="m : ${market}">
          <th:block th:if="${m.trending}">
            <div class="relative industry-card"
                 th:with="isFavorite=${wishlist != null and (wishlist.?[marketid.id == m.id]).size() > 0}"
                 th:attr="data-id=${m.id},data-name=${m.name},data-status=${m.marketStatus},data-growth=${m.growthRate30d},data-is-favorite=${isFavorite}">
              <!-- Favorite Button -->
              <button type="button"
                      th:class="${isFavorite} ?
                        'favorite-btn absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 shadow-sm bg-yellow-100 text-yellow-600 hover:bg-yellow-200' :
                        'favorite-btn absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 shadow-sm bg-white/80 text-slate-400 hover:bg-white hover:text-slate-600'"
                      th:attr="data-id=${m.id}"
                      title="ì¦ê²¨ì°¾ê¸° ì¶”ê°€">
                <svg class="w-4 h-4" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"
                     th:classappend="${isFavorite} ? ' fill-current' : ''"
                     th:attr="fill=${isFavorite} ? 'currentColor' : 'none'">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
              </button>

              <a th:href="@{/industry-detail(id=${m.id})}"
                 class="block bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden border border-slate-200 hover:border-slate-300 group">
                <div class="p-6">
                  <div class="flex items-start justify-between mb-4">
                    <div class="flex-1">
                      <div class="flex items-center gap-2 mb-2">
                        <h3 class="text-slate-900 group-hover:text-blue-600 transition-colors" th:text="${m.name}">ì‚°ì—…êµ°ëª…</h3>
                        <span class="px-2 py-1 bg-gradient-to-r from-orange-500 to-pink-500 text-white text-xs rounded-full">ê¸‰ìƒìŠ¹</span>
                      </div>
                      <p class="text-slate-600 text-sm line-clamp-2"
                         th:text="${#strings.isEmpty(m.description) ? 'ì‚°ì—…êµ° ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.' : m.description}">
                        ì‚°ì—…êµ° ì„¤ëª…
                      </p>
                    </div>
                    <div class="ml-4 tulip-icon" th:attr="data-status=${m.marketStatus},data-size='md'"></div>
                  </div>

                  <div class="flex items-center justify-between pt-4 border-t border-slate-100">
                    <div>
                      <div class="flex items-center gap-2 mb-1">
                        <th:block th:if="${m.growthRate30d >= 0}">
                          <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                          </svg>
                        </th:block>
                        <th:block th:unless="${m.growthRate30d >= 0}">
                          <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"/>
                          </svg>
                        </th:block>

                        <span th:class="${m.growthRate30d >= 0 ? 'text-green-600' : 'text-red-600'}"
                              th:text="${(m.growthRate30d >= 0 ? '+' : '') + #numbers.formatDecimal(m.growthRate30d,1,1) + '%'}">
                          +0.0%
                        </span>
                      </div>
                      <p class="text-xs text-slate-500">30ì¼ ì„±ì¥ë¥ </p>
                    </div>

                    <div class="text-right">
                      <p class="marketcap"
                         th:attr="data-marketcap=${m.totalmarketcap}">
                        -
                      </p>
                      <p class="text-xs text-slate-500">ì´ ì‹œê°€ì´ì•¡</p>
                    </div>

                    <div>
                      <span class="status-badge px-3 py-1 rounded-full text-sm"
                            th:attr="data-status=${m.marketStatus}"></span>
                    </div>
                  </div>

                  <div class="mt-4 flex items-center gap-2 text-sm text-slate-600">
                    <span th:text="${#numbers.formatInteger(m.stockcount,3,'COMMA')} + ' ê±°ë˜ëŸ‰'">ê±°ë˜ëŸ‰</span>
                    <span class="text-slate-300">â€¢</span>
                    <span class="text-blue-600 group-hover:underline">ìì„¸íˆ ë³´ê¸° â†’</span>
                  </div>
                </div>
              </a>
            </div>
          </th:block>
        </th:block>
      </div>
    </section>

    <!-- Other Industries -->
    <section class="mb-12" id="otherSection">
      <div class="flex items-center gap-3 mb-6">
        <svg class="w-7 h-7 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
        </svg>
        <h2 class="text-slate-900">ì£¼ìš” ì‚°ì—…êµ°</h2>
      </div>

      <div id="otherList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <th:block th:each="m : ${market}">
          <th:block th:unless="${m.trending}">
            <div class="relative industry-card"
                 th:with="isFavorite=${wishlist != null and (wishlist.?[marketid.id == m.id]).size() > 0}"
                 th:attr="data-id=${m.id},data-name=${m.name},data-status=${m.marketStatus},data-growth=${m.growthRate30d},data-is-favorite=${isFavorite}">
              <!-- Favorite Button -->
              <button type="button"
                      th:class="${isFavorite} ?
                        'favorite-btn absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 shadow-sm bg-yellow-100 text-yellow-600 hover:bg-yellow-200' :
                        'favorite-btn absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 shadow-sm bg-white/80 text-slate-400 hover:bg-white hover:text-slate-600'"
                      th:attr="data-id=${m.id}"
                      title="ì¦ê²¨ì°¾ê¸° ì¶”ê°€">
                <svg class="w-4 h-4" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"
                     th:classappend="${isFavorite} ? ' fill-current' : ''"
                     th:attr="fill=${isFavorite} ? 'currentColor' : 'none'">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
              </button>

              <a th:href="@{/industry-detail(id=${m.id})}"
                 class="block bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden border border-slate-200 hover:border-slate-300 group">
                <div class="p-6">
                  <div class="flex items-start justify-between mb-4">
                    <div class="flex-1">
                      <div class="flex items-center gap-2 mb-2">
                        <h3 class="text-slate-900 group-hover:text-blue-600 transition-colors" th:text="${m.name}">ì‚°ì—…êµ°ëª…</h3>
                      </div>
                      <p class="text-slate-600 text-sm line-clamp-2"
                         th:text="${#strings.isEmpty(m.description) ? 'ì‚°ì—…êµ° ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.' : m.description}">
                        ì‚°ì—…êµ° ì„¤ëª…
                      </p>
                    </div>
                    <div class="ml-4 tulip-icon" th:attr="data-status=${m.marketStatus},data-size='md'"></div>
                  </div>

                  <div class="flex items-center justify-between pt-4 border-t border-slate-100">
                    <div>
                      <div class="flex items-center gap-2 mb-1">
                        <th:block th:if="${m.growthRate30d >= 0}">
                          <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                          </svg>
                        </th:block>
                        <th:block th:unless="${m.growthRate30d >= 0}">
                          <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"/>
                          </svg>
                        </th:block>

                        <span th:class="${m.growthRate30d >= 0 ? 'text-green-600' : 'text-red-600'}"
                              th:text="${(m.growthRate30d >= 0 ? '+' : '') + #numbers.formatDecimal(m.growthRate30d,1,1) + '%'}">
                          +0.0%
                        </span>
                      </div>
                      <p class="text-xs text-slate-500">30ì¼ ì„±ì¥ë¥ </p>
                    </div>

                    <div class="text-right">
                      <p class="marketcap"
                         th:attr="data-marketcap=${m.totalmarketcap}">
                        -
                      </p>
                      <p class="text-xs text-slate-500">ì´ ì‹œê°€ì´ì•¡</p>
                    </div>

                    <div>
                      <span class="status-badge px-3 py-1 rounded-full text-sm"
                            th:attr="data-status=${m.marketStatus}"></span>
                    </div>
                  </div>

                  <div class="mt-4 flex items-center gap-2 text-sm text-slate-600">
                    <span th:text="${#numbers.formatInteger(m.stockcount,3,'COMMA')} + ' ê±°ë˜ëŸ‰'">ê±°ë˜ëŸ‰</span>
                    <span class="text-slate-300">â€¢</span>
                    <span class="text-blue-600 group-hover:underline">ìì„¸íˆ ë³´ê¸° â†’</span>
                  </div>
                </div>
              </a>
            </div>
          </th:block>
        </th:block>
      </div>
    </section>

    <!-- No Results -->
    <div id="noResults" class="text-center py-16" style="display: none;">
      <div class="text-6xl mb-4">ğŸ”</div>
      <h3 class="text-slate-900 mb-2">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
      <p class="text-slate-600 mb-6">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ í•„í„°ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”</p>
      <button onclick="resetFilters()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
        í•„í„° ì´ˆê¸°í™”
      </button>
    </div>

    <!-- Tulip Guide -->
    <div class="mt-16 p-6 bg-white rounded-xl border border-slate-200">
      <h3 class="text-slate-900 mb-3">íŠ¤ë¦½ ì§€í‘œ ê°€ì´ë“œ</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4" id="tulipGuide"></div>
    </div>
  </div>

  <!-- data.js ì œê±°: ì´ì œ ì„œë²„ì—ì„œ modelë¡œ ë‚´ë ¤ì˜´ -->
  <script src="/js/tulip.js"></script>
  <script src="/js/index-ssr.js"></script>
</body>
<script>
  function comma(str) {
    return str.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  function formatMarketCap(raw) {
    if (raw == null || raw === "") return "-";

    let sign = "";
    let v = BigInt(raw);
    if (v < 0n) { sign = "-"; v = -v; }

    const JO  = 1_000_000_000_000n; // 1ì¡°
    const EOK = 100_000_000n;       // 1ì–µ

    if (v >= JO) {
      // ì†Œìˆ˜ 1ìë¦¬ ë°˜ì˜¬ë¦¼: (v/JO).toFixed(1)ê³¼ ë¹„ìŠ·í•˜ê²Œ
      const scaled = (v * 10n + JO / 2n) / JO; // x10 í›„ ë°˜ì˜¬ë¦¼
      const intPart = scaled / 10n;
      const dec = scaled % 10n;
      return `${sign}${comma(intPart.toString())}.${dec}ì¡°`;
    }

    if (v >= EOK) {
      // ì–µ ë‹¨ìœ„ ì •ìˆ˜ ë°˜ì˜¬ë¦¼ (ì›í•˜ë©´ ë°˜ì˜¬ë¦¼ ë¹¼ê³  v/EOKë¡œ ë°”ê¿”ë„ ë¨)
      const eok = (v + EOK / 2n) / EOK;
      return `${sign}${comma(eok.toString())}ì–µ`;
    }

    return `${sign}â‚©${comma(v.toString())}`;
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".marketcap[data-marketcap]").forEach(el => {
      el.textContent = formatMarketCap(el.dataset.marketcap);
    });
  });
</script>
</html>
